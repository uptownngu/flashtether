<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Flash USDT 생성하기 - 결제</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 30px;
      text-align: center;
    }
    input[type="number"], input[type="text"] {
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
      width: 300px;
    }
    label {
      font-size: 18px;
      margin-right: 15px;
      cursor: pointer;
    }
    .payment-methods {
      margin: 20px 0;
    }
    .payment-method {
      margin-bottom: 10px;
    }
    .amount {
      font-size: 20px;
      margin: 15px 0;
    }
    .qrCodeBox {
      margin: 0 auto 20px;
      width: 180px;
      height: 180px;
    }
    button {
      background-color: #1a73e8;
      border: none;
      color: white;
      padding: 15px 40px;
      font-size: 20px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
    }
    button:disabled {
      background-color: #555;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

  <h1>Flash USDT 생성하기</h1>
  <h3>TRX, USDT(trc-20), BTC 결제 지원</h3>

  <div>
    <label for="quantityInput">구매 수량 입력 (기본 30000)</label><br />
    <input type="number" id="quantityInput" placeholder="30000" min="1" step="1" />
  </div>

  <div class="payment-methods">
    <div class="payment-method">
      <input type="radio" id="payBTC" name="paymentMethod" value="btc" checked />
      <label for="payBTC">BTC 결제</label>
    </div>
    <div class="payment-method">
      <input type="radio" id="payTRX" name="paymentMethod" value="trx" />
      <label for="payTRX">TRX 결제</label>
    </div>
    <div class="payment-method">
      <input type="radio" id="payUSDT" name="paymentMethod" value="usdt" />
      <label for="payUSDT">USDT (TRC-20) 결제</label>
    </div>
  </div>

  <div>
    <label for="walletAddress">수령 지갑 주소 입력</label><br />
    <input type="text" id="walletAddress" placeholder="예: TKzw7vLBBFD8GgTt7BD6BmWnou8ujTpbua" />
  </div>

  <div class="amount" id="amountDisplay">-</div>

  <div class="qrCodeBox" id="qrCode"></div>

  <button id="nextBtn" disabled>다음 / Next</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    const baseQuantity = 30000;
    const baseBTC = 0.0016901;
    const baseTRX = 653.23725;
    const baseUSDT = 185;

    const BTC_ADDR = "bc1qrq3gwvsxtj7ujvhmadcufe82s06z3y83yu7wmx";
    const TRX_ADDR = "TKzw7vLBBFD8GgTt7BD6BmWnou8ujTpbua";

    const quantityInput = document.getElementById("quantityInput");
    const walletAddressInput = document.getElementById("walletAddress");
    const paymentMethods = document.getElementsByName("paymentMethod");
    const amountDisplay = document.getElementById("amountDisplay");
    const qrCodeDiv = document.getElementById("qrCode");
    const nextBtn = document.getElementById("nextBtn");

    let qrCode;

    function getSelectedMethod() {
      for (const pm of paymentMethods) {
        if (pm.checked) return pm.value;
      }
      return "btc"; // 기본값
    }

    function updateAmountAndQR() {
      let quantity = parseInt(quantityInput.value);
      if (!quantity || quantity < 1) quantity = baseQuantity;

      const method = getSelectedMethod();

      let payAmount = 0;
      let payAddress = "";
      let uri = "";

      if (method === "btc") {
        payAmount = ((quantity / baseQuantity) * baseBTC).toFixed(8);
        payAddress = BTC_ADDR;
        uri = `bitcoin:${payAddress}?amount=${payAmount}`;
        amountDisplay.textContent = `${payAmount} BTC`;
      } else if (method === "trx") {
        payAmount = ((quantity / baseQuantity) * baseTRX).toFixed(5);
        payAddress = TRX_ADDR;
        uri = `tron:${payAddress}?amount=${payAmount}`;
        amountDisplay.textContent = `${payAmount} TRX`;
      } else if (method === "usdt") {
        payAmount = ((quantity / baseQuantity) * baseUSDT).toFixed(2);
        payAddress = TRX_ADDR;
        uri = `tron:${payAddress}?amount=${payAmount}`;
        amountDisplay.textContent = `${payAmount} USDT`;
      }

      if (qrCode) {
        qrCode.clear();
        qrCode.makeCode(uri);
      } else {
        qrCode = new QRCode(qrCodeDiv, {
          text: uri,
          width: 180,
          height: 180,
          colorDark: "#ffffff",
          colorLight: "#000000",
        });
      }

      validateForm();
    }

    function validateForm() {
      const qtyValid = quantityInput.value && parseInt(quantityInput.value) > 0;
      const walletValid = walletAddressInput.value && walletAddressInput.value.trim().length >= 10; // 최소길이 임의설정
      nextBtn.disabled = !(qtyValid && walletValid);
    }

    quantityInput.addEventListener("input", () => {
      updateAmountAndQR();
      validateForm();
    });
    walletAddressInput.addEventListener("input", validateForm);
    for (const pm of paymentMethods) {
      pm.addEventListener("change", updateAmountAndQR);
    }

    nextBtn.addEventListener("click", () => {
      const quantity = quantityInput.value;
      const method = getSelectedMethod();
      const wallet = walletAddressInput.value.trim();

      if (!quantity || quantity < 1 || !wallet) {
        alert("구매 수량과 지갑 주소를 정확히 입력해 주세요.\nPlease enter valid quantity and wallet address.");
        return;
      }

      // 다음 페이지로 이동, GET 파라미터로 값 전달
      const url = `confirm.html?quantity=${encodeURIComponent(quantity)}&method=${encodeURIComponent(method)}&wallet=${encodeURIComponent(wallet)}`;
      window.location.href = url;
    });

    // 초기 실행
    updateAmountAndQR();
    validateForm();
  </script>

</body>
</html>
